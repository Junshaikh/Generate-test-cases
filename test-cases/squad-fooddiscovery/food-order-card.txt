@P0 @smoke @login

Feature: Ordering Food with Saved Credit Card

Background:
    Given User is logged in with Pro subscription
    And User is on the Talabat home screen

Scenario: Order food successfully using a saved credit card
    When User taps on the "Food" icon
    Then User should be navigated to the food vendor list screen
    When User selects a restaurant from the list
    Then User should be navigated to the restaurant's menu
    When User adds an item to the basket
    And User taps on the "View Basket" button
    Then User should be navigated to the basket screen
    When User taps on the "Checkout" button
    Then User should be navigated to the checkout screen
    And User sees their saved credit card as a payment option
    When User selects the saved credit card
    And User taps on "Place Order"
    Then User should see an order confirmation message
    And User should receive an order confirmation notification
    And The order status should be updated to "Confirmed"

Scenario: Order food and verify saved card details
    When User taps on the "Food" icon
    Then User should be navigated to the food vendor list screen
    When User selects a restaurant from the list
    Then User should be navigated to the restaurant's menu
    When User adds an item to the basket
    And User taps on the "View Basket" button
    Then User should be navigated to the basket screen
    When User taps on the "Checkout" button
    Then User should be navigated to the checkout screen
    And User sees their saved credit card as a payment option
    Then User verifies the card number is partially masked with correct bank
    And User verifies the card expiry date displayed correctly
    When User selects the saved credit card
    And User taps on "Place Order"
    Then User should see an order confirmation message
    And User should receive an order confirmation notification
    And The order status should be updated to "Confirmed"

Scenario: Order food with saved card and apply a promo code
    When User taps on the "Food" icon
    Then User should be navigated to the food vendor list screen
    When User selects a restaurant from the list
    Then User should be navigated to the restaurant's menu
    When User adds an item to the basket
    And User taps on the "View Basket" button
    Then User should be navigated to the basket screen
    When User taps on the "Checkout" button
    Then User should be navigated to the checkout screen
    And User sees their saved credit card as a payment option
    When User applies a valid promo code
    Then User verifies the discount is applied
    When User selects the saved credit card
    And User taps on "Place Order"
    Then User should see an order confirmation message
    And User should receive an order confirmation notification
    And The order status should be updated to "Confirmed"

Scenario: Order food with saved card and verify delivery address
    When User taps on the "Food" icon
    Then User should be navigated to the food vendor list screen
    When User selects a restaurant from the list
    Then User should be navigated to the restaurant's menu
    When User adds an item to the basket
    And User taps on the "View Basket" button
    Then User should be navigated to the basket screen
    When User taps on the "Checkout" button
    Then User should be navigated to the checkout screen
    Then User verifies the delivery address displayed is correct
    And User sees their saved credit card as a payment option
    When User selects the saved credit card
    And User taps on "Place Order"
    Then User should see an order confirmation message
    And User should receive an order confirmation notification
    And The order status should be updated to "Confirmed"

Scenario: Order food with saved card and cancel order
    When User taps on the "Food" icon
    Then User should be navigated to the food vendor list screen
    When User selects a restaurant from the list
    Then User should be navigated to the restaurant's menu
    When User adds an item to the basket
    And User taps on the "View Basket" button
    Then User should be navigated to the basket screen
    When User taps on the "Checkout" button
    Then User should be navigated to the checkout screen
    And User sees their saved credit card as a payment option
    When User selects the saved credit card
    And User taps on "Place Order"
    Then User should see an order confirmation message
    And User should receive an order confirmation notification
    And The order status should be updated to "Confirmed"
    When User cancels the order
    Then User verifies the order is cancelled successfully
    And User verifies the refund is processed to saved card